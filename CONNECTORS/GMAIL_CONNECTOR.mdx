---
title: "Gmail Connector"
description: "Details on how Macru integrates with your Gmail account."
---

# Gmail Connector

Macru can connect to your Gmail account to ingest email data, allowing you to include your email communications in your searchable knowledge base.

## Features

*   **OAuth 2.0 Connection**: Securely authorize Macru to access your Gmail account using Google's standard OAuth 2.0 flow. Requires `gmail.readonly`, `userinfo.email`, and `openid` scopes.
*   **Email Ingestion**: Retrieves email content including headers (Subject, From, Date) and the email body.
*   **Body Parsing**: Attempts to parse the email body, preferring plain text versions when available and applying basic HTML stripping otherwise.
*   **Recent Email Focus**: The initial sync typically focuses on fetching recent emails (e.g., last 24 hours) to provide timely data quickly. Delta syncs based on `lastSyncTime` are planned for future enhancements.
*   **Manual Sync**: A "Sync Now" button in the settings allows users to trigger an immediate sync.
*   **Source Linking**: Ingested emails are stored with metadata allowing them to be linked back to the original message in Gmail.

## Connection Process

1.  Navigate to the **Settings** page in the Macru dashboard.
2.  Find the **Gmail** integration section.
3.  Click the "Connect" button.
4.  You will be redirected to Google to authorize Macru. You will need to grant permission for Macru to read your emails and access basic profile information (email).
    *   *Note: Similar to Google Calendar, if the Google Cloud app is unverified during development, you may need to add your email as a test user in the Google Cloud Console OAuth Consent Screen settings.*
5.  After authorization, you'll be redirected back to Macru.
6.  The connection status, including the connected Google account email, will be displayed in the settings.

## Implementation Details

*   **Connector Logic**: `lib/connectors/gmail.ts` (implements the `DataConnector` interface, includes `transformMessage` for parsing).
*   **Authentication Flow**:
    *   Start: `app/api/connectors/gmail/auth/start/route.ts`
    *   Callback: `app/api/connectors/gmail/auth/callback/route.ts` (handles code exchange, token saving to `connector_tokens` table).
*   **Status Check**: `app/api/connectors/gmail/status/route.ts` (includes logic for token refresh).
*   **Disconnection**: `app/api/connectors/gmail/disconnect/route.ts` (includes token revocation).
*   **Sync Endpoint**: `app/api/sync/gmail/route.ts` (triggered manually).
*   **Libraries Used**: `googleapis`.

*Key development steps and debugging details can be found in `devlog.txt` entries:*
*   *`[2025-05-07] Gmail Connector Implementation (Initial)`*
*   *`[2025-05-07] Gmail Connector Source Display Fixes`*

## Data Handling

*   The connector fetches emails using the `gmail.users.messages.list` and `gmail.users.messages.get` APIs.
*   The `transformMessage` function extracts key headers and attempts to get a clean text representation of the body.
*   The email `subject` is stored in the `documents.title` column.
*   A constructed `gmailUrl` (linking to the specific message) is stored in `documents.source_url`.
*   The Gmail Message ID is typically stored as the `source_id`.
*   The extracted/parsed body content is passed to the `DocumentProcessor` for chunking and embedding. 